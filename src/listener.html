<script type="text/javascript">
    RED.nodes.registerType('smeListener', {
        category: 'semilimesAPI',
        color: "#D7D7A0",
        defaults: {
            connector: { type: 'sme-main-connector', required: true }
        },
        inputs: 0,
        outputs: 1,
        align: 'left',
        icon: "font-awesome/fa-rss",
        paletteLabel: 'Listener',
        label: 'semilimes listener',
    });
</script>

<script type="text/html" data-template-name="smeListener">
    <div style="max-width:500px">Listen to incoming events from semilimes. You can create many instances, but one is enough.</div>
    <br />
    <div class="form-row">
        <label for="node-input-connector"><i class="fa fa-cog"></i> Connector</label>
        <input type="text" id="node-input-connector" placeholder="semilimes connector" />
    </div>
    <div style="font-size: smaller;max-width:500px;">Connector could be sharely used for other nodes.</div>
</script>

<script type="text/html" data-help-name="smeListener">
    <p>Listen to inbound events from semilimes server using a semilimes connector.</p>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>
            msg._sme.receivedMsg <span class="property-type">object</span>
        </dt>
        <dd>
            This data structure contains the received event from the server, via a default WebSocket created by the connector.
            It may contain received messages in any chat (eventType: "MessageReceived", featureType: "P2P" | "GroupChat" | "Channel"), including form submissions.
            The message content may be of any supported form (text messages, form messages, ...).
            The general data format is the following:
            <pre>
{
    "domain": "...",
    "eventType": "MessageReceived",
    "eventBody":{
        "messageId":"...",
        "senderId":"...",
        "receivedOn": 1706282794267,
        "dataComponent": {...}
    }
}
            </pre>
            Alternatively, the received event may contain server responses (eventType: "Response"), as a result of a request call made via websocket. 
            The matching between the request and response is done by saving the requestId in the Sender node, and filtering by the same requestId in the Listener node.
        </dd>
    </dl>

    <h3>References</h3>
    <ul>
        <li><a href="https://www.semilimes.com/developers/#inbound-events" target="_blank">Inbound messages</a> - full description of the received message formats and their properties.</li>
        <li><a href="https://github.com/semimob/node-red-connector.git" target="_blank">GitHub</a> - the nodes github repository</li>
    </ul>
</script>`